name: Argus Daily Run

on:
  schedule:
    # Run daily at 9 AM UTC (5 AM NST / 4 AM NDT)
    - cron: '0 9 * * *'
  workflow_dispatch:  # Allow manual triggering

jobs:
  argus-analysis:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          if [ -f pyproject.toml ]; then pip install -e .; fi
      
      - name: Run Argus Analysis
        run: |
          echo "Running Argus (Autonomous CTO) daily analysis..."
          # Run Argus governance checks
          if [ -d argus ]; then
            python -m argus.validator
          fi
          echo "Argus analysis complete."
      
      - name: Create Issue if Analysis Fails
        if: failure()
        uses: actions/github-script@v8
        with:
          script: |
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: 'Argus Daily Analysis Failed',
              body: 'The Argus daily analysis run has failed. Please review the workflow logs.',
              labels: ['argus', 'automated']
            })
